<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>LChat â€“ Language Helper</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body { font-family: Arial, sans-serif; background:#f4f6f8; padding: 300px;padding-top: 50px;padding-bottom: 50px;}
    header { background:#4f46e5; color:white; padding:1rem; text-align:center; border-radius: 20px; }
    main { max-width:800px; margin:2rem auto; background:white; padding:1.5rem; border-radius:12px; }
    select, textarea, button { width:100%; margin-top:1rem; padding:0.8rem; }
    textarea { height:90px; }
    .chat { margin-top:1.5rem; }
    .msg { margin-bottom:1rem; padding:0.8rem; border-radius:8px; }
    .user { background:#e0e7ff; }
    .bot { background:#ecfeff; }
    footer { text-align:center; margin-top:2rem; color:#666; }
    #context{margin-bottom: 10px;}
    #fromLang{margin-bottom: 10px;}
  </style>
</head>
<body>
<header>
  <h1>LChat â€“ Language Helper</h1>
  <p>Real-time, context-aware translation assistant</p>
</header>
<main>
  <label>Context</label>
  <select id="context">
    <option value="casual">Casual / Daily life</option>
    <option value="academic">Academic</option>
    <option value="medical">Medical</option>
  </select>

  <label>From language</label>
  <select id="fromLang">
    <option value="auto">Auto-detect</option>
    <option value="fr">French</option>
    <option value="en">English</option>
    <option value="ar">Arabic</option>
  </select>

  <label>To language</label>
  <select id="toLang">
    <option value="en">English</option>
    <option value="fr">French</option>
    <option value="ar">Arabic</option>
  </select>

  <textarea id="input" placeholder="Type or speak here..."></textarea>
  <button onclick="translateText()">Translate</button>
  <button onclick="startVoice()">ðŸŽ¤ Speak</button>

  <div class="chat" id="chat"></div>
</main>
<footer>
  LChat prototype â€“ Student Project
</footer>

<script>
async function translateText(textFromVoice = null) {
  try {
  const input = textFromVoice || document.getElementById('input').value;
  if (!input) return;

  const chat = document.getElementById('chat');
  const userMsg = document.createElement('div');
  userMsg.className = 'msg user';
  userMsg.innerText = input;
  chat.appendChild(userMsg);

  const from = document.getElementById('fromLang').value;
  const to = document.getElementById('toLang').value;
  const context = document.getElementById('context').value;

    // Translation API (no key): MyMemory
  // Docs: https://mymemory.translated.net/doc/spec.php
  let source = from;
  if (source === 'auto') {
    // Best-effort auto-detect using browser language
    source = (navigator.language || 'en').slice(0, 2);
  }

  const langpair = `${source}|${to}`;
  const url = `https://api.mymemory.translated.net/get?q=${encodeURIComponent(input)}&langpair=${encodeURIComponent(langpair)}`;

  const res = await fetch(url);
  if (!res.ok) throw new Error(`Translation request failed (${res.status})`);
  const data = await res.json();
  const translated = data?.responseData?.translatedText || '';
  if (!translated) throw new Error('No translation returned');

  const botMsg = document.createElement('div');
  botMsg.className = 'msg bot';
  botMsg.innerText = `[${context.toUpperCase()}] ${translated}`;
  chat.appendChild(botMsg);

  speak(translated, to);
  document.getElementById('input').value = '';
  } catch (err) {
    const chat = document.getElementById('chat');
    const botMsg = document.createElement('div');
    botMsg.className = 'msg bot';
    botMsg.innerText = `âš ï¸ Translation error: ${err.message}`;
    chat.appendChild(botMsg);
  }
}

function startVoice() {
  const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
  if (!SpeechRecognition) {
    alert('Speech recognition is not supported in this browser. Try Chrome/Edge.');
    return;
  }
  const recognition = new SpeechRecognition();

  // Use selected source language when available
  let from = document.getElementById('fromLang').value;
  if (from === 'auto') from = (navigator.language || 'en').slice(0, 2);
  const map = { en: 'en-US', fr: 'fr-FR', ar: 'ar' };
  recognition.lang = map[from] || 'en-US';
  recognition.start();

  recognition.onresult = (event) => {
    const text = event.results[0][0].transcript;
    translateText(text);
  };
}

function speak(text, lang) {
  const utterance = new SpeechSynthesisUtterance(text);
  // Map short codes to better TTS locales
  const map = { en: 'en-US', fr: 'fr-FR', ar: 'ar' };
  utterance.lang = map[lang] || lang || 'en-US';
  speechSynthesis.speak(utterance);
}
</script>
</body>
</html>
